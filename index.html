<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIFA Tournament Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #020617;
            color: #f8fafc;
        }

        .glass {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .btn-active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            transition: all 0.2s;
        }

        .btn-active:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.3);
        }

        .nav-item {
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }

        .nav-item.active {
            border-color: #3b82f6;
            color: #3b82f6;
        }
    </style>
</head>

<body class="min-h-screen selection:bg-blue-500/30">

    <!-- Navigation -->
    <nav class="glass sticky top-0 z-50 px-6 py-4">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <h1
                class="text-2xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-indigo-500 tracking-tighter">
                üéÆ FIFA LEAGUE MANAGER
            </h1>
            <div class="flex gap-6 text-sm font-semibold uppercase tracking-widest text-gray-400">
                <button onclick="switchView('setup')" id="nav-setup" class="nav-item">Setup</button>
                <button onclick="switchView('matches')" id="nav-matches" class="nav-item">Matches</button>
                <button onclick="switchView('standings')" id="nav-standings" class="nav-item">Standings</button>
            </div>
            <button onclick="resetTournament()"
                class="text-xs text-red-500/60 hover:text-red-500 transition border border-red-500/20 px-3 py-1 rounded-full">Reset</button>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto px-4 sm:px-6 py-6 sm:py-12">

        <!-- SETUP VIEW -->
        <section id="view-setup" class="view space-y-8 sm:space-y-12">
            <div class="grid lg:grid-cols-2 gap-6 sm:gap-12">
                <!-- Players -->
                <div class="glass p-5 sm:p-8 rounded-2xl sm:rounded-3xl shadow-xl">
                    <h2 class="text-lg sm:text-xl font-bold mb-6 text-blue-400 flex items-center gap-2">
                        <span>üë•</span> Step 1: Add Players
                    </h2>
                    <div class="flex flex-col sm:flex-row gap-3 mb-6">
                        <input type="text" id="player-name" placeholder="Name (e.g. Ali)"
                            class="bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 w-full outline-none focus:border-blue-500 transition">
                        <button onclick="addPlayer()"
                            class="btn-active px-6 py-3 rounded-xl font-bold whitespace-nowrap">Add Player</button>
                    </div>
                    <div id="player-list" class="flex flex-wrap gap-2"></div>
                </div>

                <!-- Teams -->
                <div class="glass p-5 sm:p-8 rounded-2xl sm:rounded-3xl shadow-xl">
                    <h2 class="text-lg sm:text-xl font-bold mb-6 text-indigo-400 flex items-center gap-2">
                        <span>üèüÔ∏è</span> Step 2: Assign Teams
                    </h2>

                    <div class="space-y-6">
                        <!-- Player Selector Cards -->
                        <div id="player-selector-container" class="grid grid-cols-2 sm:grid-cols-3 gap-2">
                            <!-- Dynamic player selection cards will go here -->
                        </div>

                        <div id="team-input-area" class="hidden">
                            <div class="bg-indigo-500/10 border border-indigo-500/20 p-4 rounded-xl mb-4">
                                <p class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-1">Adding
                                    for:</p>
                                <p id="active-player-name" class="text-lg font-black text-white"></p>
                            </div>

                            <div class="flex flex-col sm:flex-row gap-2">
                                <input type="text" id="team-name" placeholder="Team (e.g. Real Madrid)"
                                    list="team-suggestions"
                                    class="bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 w-full outline-none focus:border-indigo-500 transition">
                                <button onclick="addTeam()"
                                    class="bg-indigo-600 hover:bg-indigo-500 px-8 py-3 rounded-xl font-bold transition shadow-lg shadow-indigo-600/20">
                                    <span>Add</span>
                                </button>
                            </div>

                            <!-- Autofill Suggestions -->
                            <datalist id="team-suggestions">
                                <option value="Real Madrid"></option>
                                <option value="Manchester City"></option>
                                <option value="Liverpool"></option>
                                <option value="Paris Saint-Germain"></option>
                                <option value="Bayern Munich"></option>
                                <option value="Barcelona"></option>
                                <option value="Arsenal"></option>
                                <option value="Manchester United"></option>
                                <option value="Chelsea"></option>
                                <option value="Inter Milan"></option>
                                <option value="AC Milan"></option>
                                <option value="Juventus"></option>
                                <option value="Atletico Madrid"></option>
                                <option value="Borussia Dortmund"></option>
                                <option value="Napoli"></option>
                                <option value="Tottenham Hotspur"></option>
                                <option value="Bayer Leverkusen"></option>
                                <option value="Al Nassr"></option>
                                <option value="Al Hilal"></option>
                                <option value="Inter Miami"></option>
                            </datalist>
                        </div>
                    </div>

                    <div id="team-list" class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
                </div>
            </div>

            <!-- Generate -->
            <div
                class="glass p-8 sm:p-12 rounded-3xl sm:rounded-[2rem] text-center border-blue-500/20 shadow-2xl shadow-blue-500/5">
                <h2 class="text-xl sm:text-2xl font-bold mb-4">Step 3: Ready for Kickoff?</h2>
                <p class="text-sm text-gray-400 mb-8 max-w-xl mx-auto">This generates a Double Round Robin schedule.
                    Teams owned by the same player will never play each other.</p>
                <button onclick="generateSchedule()"
                    class="btn-active w-full sm:w-auto px-12 py-4 sm:py-5 rounded-2xl text-lg sm:text-xl font-black uppercase tracking-tighter">
                    üöÄ Start Tournament
                </button>
            </div>
        </section>

        <!-- MATCHES VIEW -->
        <section id="view-matches" class="view hidden space-y-8 sm:space-y-12">
            <div id="next-match-container"></div>

            <div class="grid lg:grid-cols-2 gap-8 sm:gap-12">
                <div>
                    <h3 class="text-lg sm:text-xl font-bold mb-6 text-blue-400 flex items-center gap-2">
                        <span>üìÖ</span> Upcoming
                    </h3>
                    <div id="upcoming-list" class="space-y-3"></div>
                </div>
                <div>
                    <h3 class="text-lg sm:text-xl font-bold mb-6 text-slate-500 flex items-center gap-2">
                        <span>‚åõ</span> Results
                    </h3>
                    <div id="history-list" class="space-y-3"></div>
                </div>
            </div>
        </section>

        <!-- STANDINGS VIEW -->
        <section id="view-standings" class="view hidden space-y-8 sm:space-y-12">
            <div class="flex flex-col gap-6">
                <div>
                    <h2 class="text-3xl sm:text-4xl font-black mb-4 tracking-tighter text-center sm:text-left">League
                        Table</h2>
                    <div class="w-full h-2 bg-slate-900 rounded-full overflow-hidden">
                        <div id="progress-bar" class="h-full bg-blue-500 transition-all duration-700" style="width: 0%">
                        </div>
                    </div>
                    <div id="progress-text" class="text-[10px] text-gray-500 mt-2 uppercase font-bold">Progress: 0%
                    </div>
                </div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="exportJSON()"
                        class="glass flex-1 px-4 py-2 rounded-xl text-[10px] font-bold uppercase tracking-wider hover:bg-slate-800 transition">Backup</button>
                    <label
                        class="glass flex-1 px-4 py-2 rounded-xl text-[10px] font-bold uppercase tracking-wider hover:bg-slate-800 transition cursor-pointer text-center">
                        Restore
                        <input type="file" onchange="importJSON(event)" class="hidden">
                    </label>
                </div>
            </div>

            <div class="glass rounded-2xl sm:rounded-[2rem] overflow-x-auto shadow-2xl">
                <table class="min-w-full text-left">
                    <thead>
                        <tr class="bg-slate-900/50 text-gray-500 text-[9px] uppercase font-black tracking-widest">
                            <th class="px-4 sm:px-8 py-5 text-center">Pos</th>
                            <th class="px-4 sm:px-8 py-5">Team</th>
                            <th class="px-2 py-5 text-center">GP</th>
                            <th class="px-2 py-5 text-center border-l border-slate-800 text-blue-400">Pts</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body" class="divide-y divide-slate-800/50"></tbody>
                </table>
            </div>
        </section>

    </main>

    <script>
        // --- DATA MODEL ---
        let tournament = {
            players: [],
            teams: [],
            matches: [],
            activePlayer: null
        };

        // --- CORE FUNCTIONS ---
        function save() {
            localStorage.setItem('fifa_tournament_v2', JSON.stringify(tournament));
        }

        function load() {
            const saved = localStorage.getItem('fifa_tournament_v2');
            if (saved) {
                tournament = JSON.parse(saved);
                renderAll();
            }
        }

        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById('view-' + viewName).classList.remove('hidden');

            document.querySelectorAll('.nav-item').forEach(v => v.classList.remove('active'));
            document.getElementById('nav-' + viewName).classList.add('active');
        }

        // --- SETUP LOGIC ---
        function addPlayer() {
            const input = document.getElementById('player-name');
            const name = input.value.trim();
            if (name && !tournament.players.includes(name)) {
                tournament.players.push(name);
                input.value = '';
                save();
                renderAll();
            }
        }

        function selectPlayerForTeam(playerName) {
            tournament.activePlayer = playerName;
            document.getElementById('team-input-area').classList.remove('hidden');
            document.getElementById('active-player-name').innerText = playerName;
            document.getElementById('team-name').focus();
            renderAll();
        }

        function addTeam() {
            const owner = tournament.activePlayer;
            const nameInput = document.getElementById('team-name');
            const name = nameInput.value.trim();
            if (owner && name) {
                tournament.teams.push({
                    id: crypto.randomUUID(),
                    name: name,
                    owner: owner
                });
                nameInput.value = '';
                save();
                renderAll();

                // Keep focus if they want to add more for same player
                nameInput.focus();
            }
        }

        function deleteTeam(id) {
            tournament.teams = tournament.teams.filter(t => t.id !== id);
            save();
            renderAll();
        }

        function generateSchedule() {
            if (tournament.teams.length < 2) {
                alert("You need at least 2 teams!");
                return;
            }

            const teams = tournament.teams;
            let matches = [];

            // Double Round Robin Combinations
            for (let i = 0; i < teams.length; i++) {
                for (let j = 0; j < teams.length; j++) {
                    if (i !== j && teams[i].owner !== teams[j].owner) {
                        matches.push({
                            id: crypto.randomUUID(),
                            home: teams[i],
                            away: teams[j],
                            hScore: null,
                            aScore: null,
                            completed: false,
                            scorers: []
                        });
                    }
                }
            }

            // Shuffle
            matches = matches.sort(() => Math.random() - 0.5);

            // Reorder to minimize wait
            const reordered = [];
            if (matches.length > 0) {
                reordered.push(matches.pop());
                while (matches.length > 0) {
                    const last = reordered[reordered.length - 1];
                    const lastOwners = [last.home.owner, last.away.owner];

                    let bestIdx = 0;
                    let minPenalty = 100;

                    for (let k = 0; k < Math.min(matches.length, 10); k++) {
                        let penalty = 0;
                        if (lastOwners.includes(matches[k].home.owner)) penalty++;
                        if (lastOwners.includes(matches[k].away.owner)) penalty++;

                        if (penalty === 0) {
                            bestIdx = k;
                            break;
                        }
                        if (penalty < minPenalty) {
                            minPenalty = penalty;
                            bestIdx = k;
                        }
                    }
                    reordered.push(matches.splice(bestIdx, 1)[0]);
                }
            }

            tournament.matches = reordered;
            save();
            switchView('matches');
            renderAll();
        }

        // --- MATCH LOGIC ---
        function submitScore(matchId) {
            const h = parseInt(document.getElementById('score-h').value);
            const a = parseInt(document.getElementById('score-a').value);

            if (isNaN(h) || isNaN(a)) {
                alert("Enter score!");
                return;
            }

            const match = tournament.matches.find(m => m.id === matchId);
            if (match) {
                match.hScore = h;
                match.aScore = a;
                match.completed = true;

                save();
                renderAll();
            }
        }

        // --- UI RENDERING ---
        function renderAll() {
            // Step 1 List
            document.getElementById('player-list').innerHTML = tournament.players.map(p =>
                `<span class="bg-blue-500/10 text-blue-400 border border-blue-500/20 px-3 py-1 rounded-full text-[10px] font-bold">${p}</span>`
            ).join('');

            // Step 2 Player Selectors
            document.getElementById('player-selector-container').innerHTML = tournament.players.map(p => `
                <button onclick="selectPlayerForTeam('${p}')" 
                        class="p-3 sm:p-4 rounded-xl sm:rounded-2xl border-2 transition-all duration-200 text-left ${tournament.activePlayer === p ? 'border-indigo-500 bg-indigo-500/20' : 'border-slate-800 bg-slate-900/50 hover:border-slate-700'}">
                    <p class="text-[8px] text-gray-500 font-black uppercase mb-1">Player</p>
                    <p class="text-xs sm:text-sm font-bold truncate">${p}</p>
                    <p class="text-[8px] text-indigo-400 mt-1 font-bold">${tournament.teams.filter(t => t.owner === p).length} Teams</p>
                </button>
            `).join('');

            // Step 2 Team List
            document.getElementById('team-list').innerHTML = tournament.teams.map(t => `
                <div class="group relative bg-slate-900/80 p-3 rounded-xl flex justify-between items-center text-xs border border-slate-800">
                    <div class="truncate pr-2">
                        <p class="font-black text-white truncate">${t.name}</p>
                        <p class="text-[8px] text-gray-500 font-bold uppercase truncate">${t.owner}</p>
                    </div>
                    <button onclick="deleteTeam('${t.id}')" class="text-red-500/40 hover:text-red-500 transition-all">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>
            `).join('');

            // Matches
            const pending = tournament.matches.filter(m => !m.completed);
            const history = tournament.matches.filter(m => m.completed).reverse();

            if (pending.length > 0) {
                const next = pending[0];
                document.getElementById('next-match-container').innerHTML = `
                    <div class="glass p-6 sm:p-12 rounded-2xl sm:rounded-[2.5rem] border-blue-500/30">
                        <div class="text-center text-[10px] font-black tracking-widest text-blue-500 uppercase mb-6 sm:mb-8">Next Match</div>
                        <div class="flex items-center justify-between gap-2 sm:gap-12">
                            <div class="text-center flex-1 min-w-0">
                                <div class="text-lg sm:text-4xl font-extrabold mb-1 truncate leading-tight">${next.home.name}</div>
                                <div class="text-[10px] sm:text-sm text-gray-500 font-bold uppercase tracking-widest truncate">${next.home.owner}</div>
                                <input id="score-h" type="number" min="0" inputmode="numeric" placeholder="0" class="mt-4 sm:mt-8 bg-slate-900 border-2 border-slate-700 w-16 h-16 sm:w-24 sm:h-24 text-center text-2xl sm:text-5xl font-black rounded-xl sm:rounded-3xl focus:border-blue-500 outline-none">
                            </div>
                            <div class="text-xl sm:text-4xl text-slate-700 font-bold">-</div>
                            <div class="text-center flex-1 min-w-0">
                                <div class="text-lg sm:text-4xl font-extrabold mb-1 truncate leading-tight">${next.away.name}</div>
                                <div class="text-[10px] sm:text-sm text-gray-500 font-bold uppercase tracking-widest truncate">${next.away.owner}</div>
                                <input id="score-a" type="number" min="0" inputmode="numeric" placeholder="0" class="mt-4 sm:mt-8 bg-slate-900 border-2 border-slate-700 w-16 h-16 sm:w-24 sm:h-24 text-center text-2xl sm:text-5xl font-black rounded-xl sm:rounded-3xl focus:border-blue-500 outline-none">
                            </div>
                        </div>
                        <div class="mt-8 max-w-xs mx-auto text-center">
                            <button onclick="submitScore('${next.id}')" class="btn-active w-full py-4 rounded-xl sm:rounded-3xl font-black text-lg tracking-tighter uppercase">Submit</button>
                        </div>
                    </div>
                `;
            } else if (tournament.matches.length > 0) {
                document.getElementById('next-match-container').innerHTML = `
                    <div class="glass p-12 rounded-[2rem] text-center">
                        <div class="text-5xl mb-6">üèÜ</div>
                        <h2 class="text-3xl font-black tracking-tighter italic">FINALE COMPLETO!</h2>
                        <p class="text-gray-500 mt-2 font-bold uppercase tracking-widest text-[10px]">Legend Stays Forever</p>
                    </div>
                `;
            }

            document.getElementById('upcoming-list').innerHTML = pending.slice(1, 11).map(m => `
                <div class="bg-slate-900/40 p-3 rounded-xl flex justify-between items-center text-[10px] border border-slate-800/50">
                    <div class="flex-1 text-right font-black uppercase text-gray-400 truncate">${m.home.name}</div>
                    <div class="px-3 text-slate-800 font-bold">VS</div>
                    <div class="flex-1 font-black uppercase text-gray-400 truncate">${m.away.name}</div>
                </div>
            `).join('');

            document.getElementById('history-list').innerHTML = history.slice(0, 10).map(m => `
                <div class="bg-slate-900/30 p-3 rounded-xl flex justify-between items-center text-[10px]">
                    <div class="flex-1 text-right font-bold truncate">${m.home.name}</div>
                    <div class="px-4 text-blue-400 font-black text-sm tracking-tighter">${m.hScore} - ${m.aScore}</div>
                    <div class="flex-1 font-bold truncate">${m.away.name}</div>
                </div>
            `).join('');

            calculateStandings();
        }

        function calculateStandings() {
            const table = {};
            tournament.teams.forEach(t => {
                table[t.id] = { name: t.name, owner: t.owner, gp: 0, w: 0, d: 0, l: 0, gf: 0, ga: 0, gd: 0, pts: 0 };
            });

            tournament.matches.filter(m => m.completed).forEach(m => {
                const h = table[m.home.id];
                const a = table[m.away.id];
                h.gp++; a.gp++;
                h.gf += m.hScore; h.ga += m.aScore;
                a.gf += m.aScore; a.ga += m.hScore;

                if (m.hScore > m.aScore) { h.w++; h.pts += 3; a.l++; }
                else if (m.aScore > m.hScore) { a.w++; a.pts += 3; h.l++; }
                else { h.d++; a.d++; h.pts += 1; a.pts += 1; }
            });

            const sorted = Object.values(table).sort((a, b) => (b.pts - a.pts) || ((b.gf - b.ga) - (a.gf - a.ga)) || (b.gf - a.gf));

            document.getElementById('standings-body').innerHTML = sorted.map((t, i) => `
                <tr class="hover:bg-blue-500/5 transition group">
                    <td class="px-4 sm:px-8 py-5 text-center font-black text-gray-600 text-[10px]">${i + 1}</td>
                    <td class="px-4 sm:px-8 py-5">
                        <div class="flex flex-col">
                            <span class="font-extrabold text-blue-50 text-xs sm:text-sm truncate">${t.name}</span>
                            <span class="text-[8px] text-gray-600 font-black uppercase">${t.owner}</span>
                        </div>
                    </td>
                    <td class="px-2 py-5 text-center text-[10px] font-bold">${t.gp}</td>
                    <td class="px-2 py-5 text-center text-lg font-black bg-blue-500/5 text-blue-400 border-l border-slate-800">${t.pts}</td>
                </tr>
            `).join('');

            const comp = tournament.matches.filter(m => m.completed).length;
            const prog = tournament.matches.length > 0 ? (comp / tournament.matches.length * 100) : 0;
            document.getElementById('progress-bar').style.width = prog + '%';
            document.getElementById('progress-text').innerText = 'Progress: ' + Math.floor(prog) + '%';
        }

        // --- RESET & EXPORT ---
        function resetTournament() {
            if (confirm("THIS DELETES ALL DATA. ARE YOU SURE?")) {
                tournament = { players: [], teams: [], matches: [] };
                save();
                window.location.reload();
            }
        }

        function exportJSON() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(tournament));
            const dlAnchorElem = document.createElement('a');
            dlAnchorElem.setAttribute("href", dataStr);
            dlAnchorElem.setAttribute("download", "fifa_tournament_data.json");
            dlAnchorElem.click();
        }

        function importJSON(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    tournament = JSON.parse(e.target.result);
                    save();
                    renderAll();
                    alert("Data Restored!");
                };
                reader.readAsText(file);
            }
        }

        // Init
        load();
        switchView('setup');

    </script>
</body>

</html>